# AwesomeElixir

[![CircleCI](https://circleci.com/gh/unitymind/awesome-elixir-app.svg?style=svg)](https://circleci.com/gh/unitymind/awesome-elixir-app)

[![Screenshot-2019-08-15-at-18-31-46.png](https://i.postimg.cc/W4JHJnJ2/Screenshot-2019-08-15-at-18-31-46.png)](https://postimg.cc/SXkrBcr5)

## TDLR

Visit the running application at: [https://awesome-elixir.herokuapp.com](https://awesome-elixir.herokuapp.com)

Check generated **ExDoc** at: [https://awesome-elixir.herokuapp.com/docs/index.html](https://awesome-elixir.herokuapp.com/docs/index.html)

## Development

Issue new GitHub Personal Access Token without any allowed scope at: [https://github.com/settings/tokens](https://github.com/settings/tokens)

[![Screenshot-2019-08-15-at-18-47-58.png](https://i.postimg.cc/R0BvhNNb/Screenshot-2019-08-15-at-18-47-58.png)](https://postimg.cc/MndCrZ0y)

Application need them for expand rate limits on GitHub API calls.

### Local development server (`mix phx.server` way)

To start your application Phoenix server:

  * Install dependencies with `mix deps.get`
  * PostgreSQL config use default `postgres/postgres` username/password credentials.
  * Create and migrate your database with `mix ecto.setup`
  * Install Node.js dependencies with `cd assets && npm install`
  * Copy config/dev.secret.example.exs `cp config/dev.secret.example.exs config/dev.secret.exs`
  * Replace `token` with issued GitHub Personal Access Token 
  * Start Phoenix endpoint with `mix phx.server`
  * You can play in IEx shell as usual: `iex -s mix` (no Phoenix Endpoint and Rihanna Job Dispatcher will be started)

Now you can visit [`localhost:4000`](http://localhost:4000) from your browser.

Refresh you page periodically to catch progress on initial data scraping from [https://github.com/h4cc/awesome-elixir](https://github.com/h4cc/awesome-elixir).

Also you can run dev tools in one command: `mix check`

Coverage report is placed to: `cover/excoveralls.html`

### Local production server (`docker compose` way)

To start your application Phoenix server packed in docker using multi-stage build and `mix release` feature:

  * Run `GITHUB_TOKEN="your_issued_token" SECRET_KEY_BASE=$(mix phx.gen.secret) docker-compose up -d --build`
  
After build finished and docker-compose services up you can visit [`localhost:4001`](http://localhost:4001) from your browser.
  
To view logs from running system:
  
  * Run `docker-compose logs -f`
  
To reset your data:
  
  * Run `docker-compose down`
  * Run `docker volume rm awesome_elixir_postgres_data`
  * Repeat command from "To start section"

Please note that Ecto migration will be run as the part of startup process. No additional actions required.

Running IEx shell on running system:

  * Run `docker-compose exec web bash`
  * Run inside container shell: `bin/awesome_elixir remote`
  * Inside IEx shell: `:observer_cli.start()`

## Heroku deployment (using Heroku CLI)

Prepare locally after checkout:

  * Run `cp config/dev.secret.example.exs config/dev.secret.exs`
  * Install dependencies with `mix deps.get`
  * Compile app with `mix compile`

Create application:

```shell script
$ heroku create
Creating app... done, ⬢ floating-woodland-78564
https://floating-woodland-78564.herokuapp.com/ | https://git.heroku.com/floating-woodland-78564.git
```

Add database to stack:

```shell script
$ heroku addons:create heroku-postgresql:hobby-dev
Creating heroku-postgresql:hobby-dev on ⬢ floating-woodland-78564... free
Database has been created and is available
 ! This database is empty. If upgrading, you can transfer
 ! data from another database with pg:copy
Created postgresql-fitted-37662 as DATABASE_URL
Use heroku addons:docs heroku-postgresql to view documentation
```

Change Heroku stack:

```shell script
$ heroku stack:set container
Stack set. Next release on ⬢ floating-woodland-78564 will use container.
Run git push heroku master to create a new release on ⬢ floating-woodland-78564.
```

Set config vars on Heroku (replace HOST value `floating-woodland-78564.herokuapp.com` with generated by Heroku):

```shell script
heroku config:set DEPLOYED_ON_HEROKU=true GITHUB_TOKEN="your_issued_token" HOST="floating-woodland-78564.herokuapp.com" SECRET_KEY_BASE="$(mix phx.gen.secret)"
Setting DEPLOYED_ON_HEROKU, GITHUB_TOKEN, HOST, SECRET_KEY_BASE and restarting ⬢ floating-woodland-78564... done, v6
DEPLOYED_ON_HEROKU: true
GITHUB_TOKEN:       your_issued_token
HOST:               floating-woodland-78564.herokuapp.com
SECRET_KEY_BASE:    generated_key
```

And deploy:

```shell script
$ git push heroku master
... output ommited (see how your image is building)
remote: Verifying deploy... done.
To https://git.heroku.com/floating-woodland-78564.git
 * [new branch]      master -> master
```

Now you can visit [`https://floating-woodland-78564.herokuapp.com/`](https://floating-woodland-78564.herokuapp.com/) from your browser.